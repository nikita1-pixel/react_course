<!DOCTYPE html>
<html>
<head>
  <title>ChatBot</title>
  <style>
    body{
      font-family: Arial, Helvetica, sans-serif;
      margin: 0 0;
    }
    .send-button{
      background-color:rgb(25, 135, 84);
      color: white;
      padding: 12px 20px;
      margin-left: 10px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      cursor: pointer;
    }

    .chat-input{
      padding: 12px 20px;
      border-radius: 10px;
      border-width: 1px;
      font-size: 15px;
      margin-right: 10px;
      flex-grow: 1;
    }
    .chat-input-container{
      display: flex;
      margin-bottom: 60px;
    }
    .app-container{
      max-width: 600px;
      margin: 0 auto;
      height: 100vh;
      display: flex;
      flex-direction: column;   
       
    }
    .chat-message-user{
      display: flex;
      justify-content: flex-end;
      padding: 10px;
      margin: 10px;
      border-radius: 10px;
      color: black;
      align-items: start;
      }
    .chat-message-robot{
      display: flex;
      justify-content: flex-start;
      padding: 10px;
      margin: 10px;
      border-radius: 10px;
      color: black; 
      align-items:start;
    }
    .chat-message-text{
      background-color: rgb(238, 238, 238);
      padding: 15px 20px;
      border-radius: 10px;
      color: black;
      margin-right: 10px;
      margin-left: 10px;
      margin-bottom: 20px;
      max-width: 300px;
    }

    .robot-icon{
      width: 45px;
    }
    .user-icon{
      width: 45px;
    }
    .chat-messages-container{
      flex-grow: 1;
      margin-top: 20px;
      overflow: scroll;
      scrollbar-width: none;
    }
  </style>
</head>
<body>
  <div class="js-container"></div>

  <script src="https://unpkg.com/supersimpledev/react.js"></script>
  <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>

  <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>

  <script src="https://unpkg.com/supersimpledev/babel.js"></script>
  <script type="text/babel">

  function ChatInput({ chatMessages, setChatMessages }){
    const[inputText, setInputText] = React.useState('');

    function saveInputText(event){
      setInputText(event.target.value);
    }

    function sendMessage(){
      const newChatMeassages = [
        ...chatMessages,
        {
          message: inputText,
          sender: 'user',
          id: crypto.randomUUID()
        }
      ]
      
      setChatMessages(newChatMeassages);

       const response = Chatbot.getResponse(inputText);
         setChatMessages([
        ...newChatMeassages,
        {
          message: response,
          sender: 'robot',
          id: crypto.randomUUID()
        }
      ]);

      setInputText('');
    }
  return (
  <div className="chat-input-container">
    <input 
    className="chat-input"
      placeholder="Send a message to your ChatBot"
      size ="30" 
      onChange={saveInputText}
      value={inputText}
    />
    <button
      className="send-button" 
      onClick={sendMessage}>
        Send
      </button>
    </div>
    )}
    function ChatMessage({message, sender}){
    // const message =  props.message;
    // const sender = props.sender;
    //destructuring the props object
    // const {message, sender} = props;
                
    // if(sender === "robot"){
    //     return(
    //         <div>
    //             <img src="robot.png" width="50px"/>
    //             {message}
    //         </div>
    //     )

   // }
    return(
      <div className={sender ==='user' ? 'chat-message-user' : 'chat-message-robot'}>
      {sender === "robot" && (
        <img src="robot.png" className="robot-icon" />
      )}
      <div className="chat-message-text">
       {message}
      </div>
      { sender ==="user" && (
      <img src="user.png" className="user-icon"/>
      )}
      </div>
     )
  }

    function ChatMessages( {chatMessages}){
      const chatMessagesRef = React.useRef(null);

      React.useEffect(() => {
        const conatinerElem = chatMessagesRef.current;
        if(conatinerElem){
          conatinerElem.scrollTop = conatinerElem.scrollHeight;
        }
      },
      //dependency array = controls when useEffect runs
      [chatMessages])

    return (
      <div className="chat-messages-container"
      ref={chatMessagesRef}>
        {chatMessages.map((chatMeassge) => {
          return (
          <ChatMessage 
            message={chatMeassge.message} //props {object.message}
            sender={chatMeassge.sender}
            key={chatMeassge.id}
          />
          )
        })}
      </div>
        )
    }

    function App (){
      const [chatMessages, setChatMessages] = React.useState([{
        message : 'Hello ChatBot',
        sender : 'user',
        id: 'id1'
        },{
        message : 'Hello! How can I help you today?',
        sender : 'robot',
        id: 'id2'
        },{
        message : 'Can you get me todays date?',
        sender : 'user',
        id: 'id3'
        },{
        message : "Sure! Today's date is June 5, 2024.",
        sender : 'robot',
        id: 'id4'
      }])
      // const [chatMessages, setChatMessages] = array; //array destructuring
      // const chatMessages = array[0];//the current data
      // const setChatMessages = array[1];//updater function

    return(
      <div className="app-container">
        <ChatMessages 
         chatMessages={chatMessages}
        />
        <ChatInput 
         chatMessages={chatMessages}
         setChatMessages={setChatMessages}
        />
      </div>
      )
      }
        
      const container = document.querySelector('.js-container');
      ReactDOM.createRoot(container).render(<App />);
    </script>
  </body>
</html>